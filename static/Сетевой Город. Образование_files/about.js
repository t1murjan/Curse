!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"lngLogin",function(){return i}),n.d(t,"filter",function(){return a}),n.d(t,"login_ctor",function(){return s});var r,o;r=n(3).SessionStore;var i={kFirstYouShouldSelect:language.Generic.Login.kFirstYouShouldSelect,kEmptyAjaxAnswer:language.Generic.Login.kEmptyAjaxAnswer,kErrorAjaxListLoading:language.Generic.Login.kErrorAjaxListLoading,kFirstYouShouldSelectSchool:language.Generic.Login.kFirstYouShouldSelectSchool,kEnterLoginAndPassword:language.Generic.Login.kEnterLoginAndPassword,kLoginByECardPossibleViaIEorChrome:language.Generic.Login.kLoginByECardPossibleViaIEorChrome,kECardIDWasReset:language.Generic.Login.kECardIDWasReset,kECardIDWasRead:language.Generic.Login.kECardIDWasRead};o=_.chain(($.cookie("TTSLogin")||"").split("&")).map(function(e){return e.split("=")}).filter(function(e){return void 0!==e[1]&&e[1]}).object().value();var a=function(){function e(e,t,n,r){this.name=e,this.optional=t,this.order=n,this.initItemText=r}return e.prototype.getCooketVal=function(){var e;return e=_.findWhere(o,{name:this.name}),(null!=e?e.val:void 0)||-999999},e}(),s=function(){var e,t,n,i,s,l,u,c,d,g,p,f,m,h,v,y,b,w,S,x;return s=null,h=null,f=null,n=null,i={unselectedVal:-999999},l=null,p=null,t=null,y=null,d=function(e){return l=function(){var t,n,r;return t=e,n=function(e){return $("select[name="+e+"]",s)},r={},r=_.map(e,function(e){return n(e.name)}),$.extend(r,{showFilter:function(e){return this.getSelectByName(e).closest(".row").show()},hideFilter:function(e){return this.getSelectByName(e).closest(".row").hide()},readOnlyFilter:function(e){var t,n,r,o;return n=this.getSelectByName(e),t=n.parent(),o=$("option:selected",n).text(),r=$("<span />").text(o),t.append(r),n.hide()},getNextFilter:function(e){return a=this.getByName(e),_.find(t,function(e){return e.order===a.order+1})},getSelectByName:n,getByName:function(e){return _.find(t,function(t){return t.name===e})},disableAfter:function(e){var n,r,o;a=this.getByName(e),o=[];for(r in t)n=t[r],n.order<=a.order||o.push(l.getSelectByName(n.name).prop("disabled",!0).val(0).show().nextAll().remove());return o}}),r}(),p=$("input[name=UN], input[name=PW]",s),t=$(".button-login:not(.button-login-esia):not(.button-login-esa)",s)},v=function(e,t,n){var r,o,a,s,l;if(a=$(e),a.html(""),t&&t.length&&!(t.length<=0)){for(l=$("<option />").html(n).attr("value",i.unselectedVal),a.append(l),r=0,s=t.length;r<s;r++)o=t[r],l=$("<option />").html(o.name).attr("value",o.id),$(e).append(l);return a.prop("disabled",!1),a.show()}},c=function(){var e,t,r,a,u;return t=$.Deferred(),e=function(e){var n,r,o,a,u,c,d,g,p,m,h,y,S,k;if(r=e,k=$("select",s),p=$("select:last",s),o=k.first().attr("id"),0!==r[o].length){for(u=0,h=k.length;u<h;u++)if(S=k[u],g=$(S),c=g.attr("id"),y=g.attr("name"),a=l.getByName(y),n=r[y],d=r[c],v(S,d,a.initItemText),g.val(n),d&&1===d.length){if(n===i.unselectedVal){n=d[0].id,g.val(n),p.attr("id")!==c?x(g):l.readOnlyFilter(y);break}n!==i.unselectedVal&&(a.optional?l.hideFilter(y):l.readOnlyFilter(y))}m=p.val(),m&&m>i.unselectedVal&&(b(p),f&&f(p)),b(p)}return t.resolve(),w()},r=$.extend({},o,{cacheVer:n}),u=s.attr("id").replace("message","").replace("-",""),a="/webapi/prepare"+u+"loginform",jsSubmit({action:a,method:"get",auth:!1,defaultErrorHandling:!1,cache:!0,data:r,onError:function(e){var n,r;return 0===e.status?void t.reject("canceled"):(n=(null!=e&&null!=(r=e.responseJSON)?r.message:void 0)||language.Generic.Common.kUnexpErr,window.lalert(n),t.reject(n))},onSuccess:e}),t.promise()},x=function(e){var r;if($("input[type=text], input[type=password]",s).prop("disabled",!0),l.disableAfter(e.attr("name")),t.css("display","none"),0!==e.prop("selectedIndex"))return r=$("select",s).serialize(),r+="&LASTNAME="+e.attr("name")+"&cacheVer="+n,jsSubmit({action:"/webapi/loginform",method:"get",cache:!0,auth:!1,data:r,onSuccess:S})},e=function(e){if(13===e.which)return g()},w=function(){return $(document).trigger("login_form_ready")},S=function(e){var t,n,r,o,i;return r=e,o=l.getByName(r.lastElem),i=l.getSelectByName(r.lastElem),2===i.children().length&&(o.optional?l.hideFilter(r.lastElem):l.readOnlyFilter(r.lastElem)),t=l.getNextFilter(r.lastElem),n=l.getSelectByName(t.name),v(n,r.items,t.initItemText),n.nextAll().remove(),1===r.items.length?(n.val(r.items[0].id),l.getNextFilter(t.name)?x(n):(l.readOnlyFilter(t.name),b(n),w())):(l.showFilter(t.name),w())},u=function(e){return function(e){var t;return t=$.Deferred(),jsSubmit({action:"/webapi/auth/getdata",method:"POST",auth:!1,showProcessing:!1}).then(function(n){var r;return r=hexMD5_(n.salt+hexMD5_(e.val())),e.val(r.substr(0,e.val().length)),t.resolve({lt:n.lt,pw2:r,ver:n.ver})}).fail(function(){return t.reject()}),t.promise()}}(),g=function(e,t,n){var r,o,i;if(s=s||e,i=$("[name=UN]",s),o=$("[name=PW]",s),y="function"==typeof y?y:t,n=n||[],y(i,o))return s.find("input[name=UN]").blur(),s.find("input[name=PW]").blur(),r=$.show.processing(),u(o).then(function(e){var t;return t=s.find("select, input").serializeArray(),t.push({name:"lt",value:e.lt}),t.push({name:"pw2",value:e.pw2}),t.push({name:"ver",value:e.ver}),t.push.apply(t,n),jsSubmit({action:"/webapi/login",data:t,showProcessing:!1,auth:!1,defaultErrorHandling:!1,onError:function(e){var t,n;return r.close(),t=(null!=e&&null!=(n=e.responseJSON)?n.message:void 0)||language.Generic.Common.kUnexpErr,$.show.error(t).then(function(){return i.focus(),o.val("")})}}).then(function(e){var t,n;return e.at?(t=e.requestData||{},t.at=e.at,n={path:e.entryPoint,auth:!1,nocache:!1,params:t},e.errorMessage?(r.close(),void $.show.error(e.errorMessage).then(function(){var e;return e=$.extend({},n,{method:"GET"}),delete e.params,postTo(e)})):m(t.at).then(function(){return postTo(n)})):(r.close(),void $.show.error("ошибка авторизации"))}).always(function(){return setDBFree()})}).fail(function(){return r.close()})},m=function(e){return Promise.resolve()},b=function(e){return 0!==e.prop("selectedIndex")?(p.prop("disabled",!1),t.css("display","inline")):(p.prop("disabled",!0),t.css("display","none"))},{init:function(t,o,i,a){var l,u;return s=t,h=new r,d(o),y=i,n=a,l=c(),u=function(e){return f&&f(e),b(e)},$("select",s).prop("selectedIndex",0),$("select:not(:last)",s).change(function(){return x($(this))}),$("select:last",s).change(function(){return u($(this))}),$("select:first",s).prop("disabled",!1),$("select:not(:first)",s).prop("disabled",!0),$("input[type=text], input[type=password]",s).keypress(function(t){return e(t)}),l},login:g}}},function(e,t,n){n(2),e.exports=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i,a,s,l,u,c,d,g,p,f=n(0);c=null,r=null,deferredResLoader.loadStyle("/static/vendor/bootstrap/css/bootstrap.min.css"),deferredResLoader.loadScript("/js/md5r.min.js"),deferredResLoader.loadScript("/js/winauth.js"),deferredResLoader.loadScript("/js/PasswordRecovery.js"),deferredResLoader.loadScript("/static/vendor/bootstrap/js/bootstrap.min.js"),deferredResLoader.loadScript("/vendor/bootstrap3-dialog/js/bootstrap-dialog.min.js"),g=function(e){return $("#overlay").css("height","100%"),e.fadeIn(),-[1]?$("#overlay").fadeIn():$("#overlay").css("display","block")},a=function(e){if(e.fadeOut(),$("form[name=PasswordRecoveryForm]").is(":visible"),!$("form[name=SelectSchoolForm]").is(":visible"))return-[1]?$("#overlay").fadeOut():$("#overlay").css("display","none")},u=function(){return $("[name=recoveryType]").click(function(){return"1"===this.value?$("input[name=recoveryValue]").replaceWith('<input type="text" name="recoveryValue" style="outline: none" size="35" maxlength="80" />'):$("input[name=recoveryValue]").replaceWith('<input type="text" name="recoveryValue" style="outline: none" size="35" maxlength="11" />')}),$("#recovery").click(function(){return g($("#message-password-recovery")),$(":radio[value='E']").prop("checked",!0),$("input[name=recoveryValue]").prop("style","outline: none").prop("size",35).prop("maxlength",80).removeClass()}),$(":radio[name='recoveryType']").click(function(){if(""!==$("input[name='recoveryValue']").val())return $("input[name='recoveryValue']").val("")}),$("#cexit_recovery").click(function(){return a($("#message-password-recovery"))}),$("#message-password-recovery a.button-login").click(function(){return window.recoveryPassword()})},l=function(e){var t,n,o,i,a,l;if($("ul.tabs-form").delegate("li:not(.current)","click",function(){return $(this).addClass("current").siblings().removeClass("current").parents("div.sectiontable").find("div.box-form").eq($(this).index()).fadeIn(150).siblings("div.box-form").hide(),$.cookie("openForm",$(".current").prop("id"))}),i=[],e.schoolLogin&&(a={country:new f.filter("cid",!0,1,language.Generic.Login.kSelectCountry),state:new f.filter("sid",!1,2,language.Generic.Login.kSelectRegion),province:new f.filter("pid",!0,3,language.Generic.Login.kSelectMunicipality),city:new f.filter("cn",!1,4,language.Generic.Login.kSelectCity),funcType:new f.filter("sft",!0,5,language.Generic.Login.kSelectSchoolType),school:new f.filter("scid",!1,6,language.Generic.Login.kSelectSchool)},l=function(e,t){var n,r;return n=$("select[name=scid]").val(),r=e.val(),0===n?(alert(f.lngLogin.kFirstYouShouldSelectSchool),!1):""!==r&&""!==t.val()||(alert(f.lngLogin.kEnterLoginAndPassword),!1)},c=Object(f.login_ctor)(),$(document).on("click","#message a.button-login-marker",c.login),i.push(c.init($("#message"),a,l,e.cacheVer))),e.emLogin&&(n={country:new f.filter("em_cid",!0,1,language.Generic.Login.kSelectCountry),state:new f.filter("em_sid",!1,2,language.Generic.Login.kSelectRegion),hlevel:new f.filter("hlevel",!0,3,language.Generic.Login.kSelectHierarchyLevel),em:new f.filter("emId",!1,4,language.Generic.Login.kSelectEM)},o=function(e,t){var n,r;return n=$("select[name=emid]").val(),r=e.val(),0===n?(alert(f.lngLogin.kFirstYouShouldSelectSchool),!1):""!==r&&""!==t.val()||(alert(f.lngLogin.kEnterLoginAndPassword),!1)},r=Object(f.login_ctor)(),$(document).on("click","#message-em a.button-login-marker",r.login),i.push(r.init($("#message-em"),n,o,e.cacheVer))),i.push(deferredResLoader.promise()),extDeferred.when(i).then(function(){return window.preLoaderRemoved?void p():(window.preLoaderRemoved=!0,s(function(){return $('input[name="UN"]').focus()}),$("div.centered > div.loginbox").addClass("appear"),p())}),u(),!-[1])return t=navigator.userAgent.toLowerCase(),"8"===t.substr(t.indexOf("msie")+5,1)?($("#message .info table tr td").css("padding-top","6px"),$("#message .info table tr td").css("padding-bottom","6px"),$("#message-em .info table tr td").css("padding-top","6px"),$("#message-em .info table tr td").css("padding-bottom","6px")):void 0},s=function(e){var t,n;return t=$("#login-page-preloader"),n=t.find(".spinner"),n.fadeOut(),t.delay(350).fadeOut("slow",function(){if("function"==typeof e)return e()})},p=function(){return o().then(function(){return jsSubmit({action:"/webapi/settings/preloginnotice",method:"GET",auth:!1}).then(function(e){var t,n;if(e.showPopUp)return t="<div class='text-left' style='font-size: 16;'>"+e.popUpDisplayText+"</div>",n={closable:!1,buttons:[{label:e.popUpButtonText,cssClass:"btn-primary center-block",action:function(e){return d().then(function(){return e.close()})}}]},$.show.message(t,language.Generic.Common.kAttention,n)})})},i=function(e){var t,n,r,o;for(t=0,n=r=0,o=e.length-1;r<=o;n=r+=1)t=~~((t<<5)-t+e.charCodeAt(n));return t},o=function(){var e,t;return e=$.cookie("hash-notice_state"),t=$.Deferred(),jsSubmit({action:"/webapi/settings/preloginnotice",method:"GET",auth:!1}).then(function(n){return n.showPopUp&&i(n.popUpDisplayText)!==+e&&t.resolve(),t.reject()},function(){return t.reject()}),t.promise()},d=function(){var e;return e=31536e3,jsSubmit({action:"/webapi/settings/preloginnotice",method:"GET",auth:!1}).then(function(t){var n,r,o;if(o=t.popUpDisplayText)return r=i(o),n=new Date,n.setTime(n.getTime()+1e3*e),$.cookie("hash-notice_state",r,{expires:n})})},$(document).ready(function(){var e,t;return window.preLoaderRemoved=!1,t={},e=function(e,n){return jsSubmit({action:n,method:"GET",dataType:"html",showProcessing:!1,auth:!1}).then(function(n){return t[e]=n})},$.when(jsSubmit({action:"/webapi/logindata",method:"GET",showProcessing:!1,defaultErrorHandling:!1,auth:!1}).fail(function(e){return deferredResLoader.ready(function(){var t;return s(),(null!=e?e.responseJSON:void 0)?void $.show.error((null!=e&&null!=(t=e.responseJSON)?t.message:void 0)||(null!=e?e.statusText:void 0)||language.Generic.Common.kUnexpErr,"Ошибка инициализации формы входа"):($.show.error((null!=e?e.statusText:void 0)||language.Generic.Common.kUnexpErr,"Ошибка инициализации формы входа"),e.responseText?document.open().write(e.responseText):void 0)})})).then(function(n){var r,o,i;return r=urlHelper.getParameterByName("openForm")||$.cookie("openForm")||"",r=r.toLowerCase(),"school"!==r&&"em"!==r&&(r="school"),"em"!==r||n.emLogin||(r="school"),"school"!==r||n.schoolLogin||(r="em"),o=urlHelper.getParameterByName("LoginContextId"),i={enableSms:n.enableSms,language:language,authPage:"/postlogin.asp",productName:n.productName,schoolLogin:n.schoolLogin,emLogin:n.emLogin,severalForms:n.schoolLogin&&n.emLogin,loginContextId:o,signatureLogin:n.signatureLogin,currentForm:{school:"school"===r,em:"em"===r},esia:!1,cacheVer:n.cacheVer,windowsAuth:n.windowsAuth},n.esiaLogin&&(i.esia={mainAuth:n.esiaMainAuth,buttonMode:n.esiaButton,linkMode:!n.esiaButton,linkText:"Вход с учетной записью портала Госуслуг",loginPage:n.esiaLoginPage}),n.esaLogin&&(i.esa={buttonText:"Войти через Госуслуги",loginPage:n.esaLoginPage}),o&&(i.bindIdpAccountMessage=language.Generic.Common.kLoginAndBindNetCityAccount.replace("{0}",i.productName).replace("{1}","ЕСИА")),$.when(e("loginForm","/static/dist/pages/about/templates/loginform.html?ver="+n.version),e("extras_header","/extras/about_header.html?ver="+n.version),e("extras_footer","/extras/about_footer.html?ver="+n.version)).then(function(){var e,n;return i.extras={header:Handlebars.compile(t.extras_header)(i),footer:Handlebars.compile(t.extras_footer)(i)},n=Handlebars.compile(t.loginForm),e=n(i),$("div.body").append(e),i.esia.mainAuth&&!o&&($(".tabs-form").css("display","none"),$(".box-form").css("display","none"),$("#showLoginForm").click(function(){return $(".tabs-form").css("display","block"),$(".box-form").filter(".visible").css("display","block"),$(".box-form-auth").css("display","none")})),i.severalForms||($(".box-form").css({"padding-top":"0px"}),$(".sectiontable").css({"border-top":"1px solid #225588"}),$(".message-form").css({"padding-top":"40px"}),i.schoolLogin&&$(".img-logo").attr({src:"/vendor/custom/img/logo_netscool.png"})),l(i)})})})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStore=void 0;var a=function(){function e(t){r(this,e),this.loginRepository=t}return i(e,[{key:"getFromStorage",value:function(){var e=localStorage.getItem("session-store");return e?JSON.parse(e):[]}},{key:"setToStorage",value:function(e){localStorage.setItem("session-store",JSON.stringify(e))}},{key:"put",value:function(e){var t=this.getFromStorage();t.push(e);var n=this.getUniques(t);this.setToStorage(n)}},{key:"remove",value:function(e){var t=this.getFromStorage(),n=t.filter(function(t){return t.user.id!==e.user.id});this.setToStorage(n)}},{key:"getUniques",value:function(e){return s.groupBy(e,function(e){return e.user.id}).map(function(e){return e.values.sort(function(e,t){return new Date(e.logintime).getTime()+(e.active?1e4:0)-(new Date(t.logintime).getTime()+(t.active?1e4:0))}).pop()})}},{key:"getStored",value:function(){var e=this.getFromStorage();return this.getUniques(e)}},{key:"getActive",value:function(){var e=this,t=this.getFromStorage(),n=this.getUniques(t);return this.loginRepository.checkAccountList(n).then(function(t){var n=t.map(function(e){return Object.assign({},e)});return n.forEach(function(e){return e.activeToken=null}),e.setToStorage(n),t})}}]),e}();t.SessionStore=a;var s={groupBy:function(e,t){var n={};return e.reduce(function(e,r){var o;"function"==typeof t?o=t(r):Array.isArray(t)&&(o=t.reduce(function(e,t){return e+=r[t]+"|"},""));var i=n[o];return i||(i={key:o,values:[]},n[o]=i,e.push(i)),i.values.push(r),e},[])}}}]);